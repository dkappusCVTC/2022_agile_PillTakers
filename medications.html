<!DOCTYPE html>
<html lang="en">
<head>
    <title>Agile Programming - Team Pill Takers</title>
    <meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="css/style.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
    <header>
        <h1 class="header">Pill Takers</h1>
    </header>
    <nav>
        <ul>
            <li><a href="index.html">Home</a></li>
            <li><a href="about.html">About/Purpose</a></li>
            <li><a href="account.html">Create Account</a></li>
            <li><a href="medications.html">Enter Medications</a></li>
            <li><a href="schedule.html">Schedule</a></li>
            <li><a href="notifications.html">Notifications</a></li>
            <li><a href="contact.html">Contact</a></li>
        </ul>
    </nav>
    <main id="content">
        <h2>Add Your Medications</h2>
        <label class="labelWidth" for="medNumberText">Number of Medications to Add:</label>
        <input type="text" id="medNumberText" size="3" name="medNumberText"><br>
        <div id="medTemplate" class="medTemplate">
            <label for="medNbrText" name="medNbr"></label><br><br>
            <label for="medNameText">Medication Name:</label>
            <input type="text" id="medNameText" size="30" name="medNameText">
            <label for="doseText">Dosage:</label>
            <input type="text" id="doseText" size="30" name="doseText">
            <label for="dateTimeText">When to take it:</label>
            <input type="datetime-local" id="dateTimeText" size="50" name="dateTimeText">
            How often it needs to be taken:
            <div class="tabBlock">
                <label class="labelBlock" for="freqNumber">Every:</label>
                <input class="inline" type="text" id="freqNumber" size="3" name="freqNumber">
                <select class="inline" id="freqTime" name="freqTime">
                    <option value="freqHours">Hours</option>
                    <option value="freqDays">Days</option>
                    <option value="freqWeeks">Weeks</option>
                    <option value="freqMonths">Months</option>
                </select>
            </div>
            <input type="button" value="Remove Medication"
                   onclick="this.parentNode.parentNode.removeChild(this.parentNode);"><br>
        </div>
        <form>
            <span id="medFields"></span>
            <input type="button" value="Save Medication(s)"
                   onclick="saveMeds()">
        </form>
        <script>
            var medNbr = document.getElementById('medNumberText');
            var loadNbr = 0;
            var currentSelect = 0;
            medNbr.addEventListener('keyup', function () {
                // Determine if a integer was entered for medication count
                if (isNaN(medNbr.value) || medNbr.value < 0) return improperInput(medNbr);
                if (medNbr.value != '' && medNbr.value != currentSelect) {
                    currentSelect = medNbr.value;
                    loadNbr = medNbr.value;
                    window.onload = meds(loadNbr);
                }
            });

            function meds(inNbr) {
                if (inNbr != 0) {
                    // Remove all form elements, to clear the page
                    const el = document.querySelectorAll('.meds');
                    Array.prototype.forEach.call(el, function(node) {
                        node.parentNode.removeChild(node);
                    });
                    var counter = 0;
                    let countMed = Number(counter) + Number(inNbr);
                    for (let i = counter; i < countMed; i++) {
                        // Clones the template to an object variable
                        var newMeds = document.getElementById('medTemplate').cloneNode(true);
                        // Sets new DIV id's and class for each medication form
                        newMeds.id = 'newMed' + counter;
                        newMeds.className = 'meds';
                        // Changes the style of Medication form so that it can be visible when inserted
                        newMeds.style.display = 'block';
                        var newMed = newMeds.childNodes;
                        // Loop to change the names of the elements to append the medication number
                        for (var j = 0; j < newMed.length; j++) {
                            var theName = newMed[j].name;
                            if (theName) newMed[j].name = theName + counter;
                            if (newMed[j].htmlFor == 'medNbrText') {
                                newMed[j].innerHTML = 'Medication #' + (Number(counter) + 1);
                                newMed[j].innerText = 'Medication #' + (Number(counter) + 1);
                            }
                            if (newMed[j].type == 'button' && newMed[j].value == 'Remove Medication') newMed[j].value = newMed[j].value + ' #' + (Number(counter) + 1);
                        }
                        var insertHere = document.getElementById('medFields');
                        // Adds the Medication form to the page
                        insertHere.parentNode.insertBefore(newMeds, insertHere);
                        counter++;
                    }
                    
                } else {
                    // Remove all form elements, to clear the page
                    const el = document.querySelectorAll('.meds');
                    Array.prototype.forEach.call(el, function(node) {
                        node.parentNode.removeChild(node);
                    });
                }
            }

            function saveMeds() {
                const medList = document.querySelectorAll('.meds');
                alert('You have added ' + (medList.length ? medList.length : '0') + (medList.length == 1 ? ' medication' : ' medications'));
            }

            function improperInput(inField) {
                alert('Please enter a medication number greater than 0');
                inField.value = '';
                return; 
            }
        </script>
    </main>
    <br>
    <footer>
        <small>
            Copyright &copy; 2022 Pill Takers
            <br>
            <a href="contact.html">Contact Us</a>
        </small>
    </footer>
</body>
</html>
